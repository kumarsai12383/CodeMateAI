<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Welcome</title>
    <link rel="icon" type="image/jpeg" href="edu logo icon.jpg" />
    <link rel="stylesheet" href="welcome.css" />
    <script src="ai-chat-logic.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <!-- Responsive Navbar/Sidebar -->
    <nav class="navbar navbar-expand-lg navbar-light bg- fixed-top">
      <div class="container">
        <a class="navbar-brand" href="#"
          ><img
            class="logo"
            src="edu_logo-welcome.png"
            alt=""
            width="120px"
            height="104px"
        /></a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNavDropdown"
          aria-controls="navbarNavDropdown"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="courses.html">Courses</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="my-learnings.html">My Learnings</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">My Certificates</a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="userDropdown"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="fa fa-user-circle me-2"></i>
                <span id="nav-username">User</span>
              </a>
              <ul
                class="dropdown-menu dropdown-menu-end"
                aria-labelledby="userDropdown"
              >
                <li>
                  <span class="dropdown-item-text"
                    ><strong id="dropdown-username">Profile</strong></span
                  >
                </li>
                <li>
                  <span class="dropdown-item-text" id="dropdown-email"
                    >user@email.com</span
                  >
                </li>
                <li>
                  <a href="profile.html" class="dropdown-item"
                    >Profile Update</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a
                    class="dropdown-item text-danger"
                    href="login-wireframe.html"
                    ><i class="fa fa-sign-out-alt me-2"></i>Logout</a
                  >
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div style="height: 70px"></div>
    <!-- Spacer for fixed navbar -->
    <div class="welcome-card text-black">
      <h2 id="welcome-message">
        Welcome, <span id="welcome-username">User</span>!
      </h2>

      <p>
        Explore our features and get started with your learning journey! with AI
        assistance
      </p>
      <!-- AI Chat Dialog Box -->
      <div
        id="ai-chat-box"
        class="mt-4"
        style="
          max-width: 480px;
          margin: 0 auto;
          background: rgba(255, 255, 255, 0.12);
          border-radius: 16px;
          box-shadow: 0 2px 16px rgba(25, 118, 210, 0.1);
          padding: 1.5rem;
        "
      >
        <h5 class="mb-3" style="color: #0e57e9">
          <i class="fa fa-robot me-2"></i>Don't Know what to learn? Ask me! I'm
          your AI professor
        </h5>
        <div
          id="chat-messages"
          style="min-height: 80px; margin-bottom: 1rem"
        ></div>
        <form id="chat-form" class="d-flex">
          <input
            type="text"
            id="chat-input"
            class="form-control me-2"
            placeholder="Type Your interests (e.g., web development)"
            required
          />
          <button type="submit" class="btn btn-primary">
            <i class="fa fa-paper-plane"></i>
          </button>
        </form>
        <div id="preferred-courses" class="mt-4"></div>
      </div>
    </div>
    <footer class="footer text-secondary">
      Â© 2025, <strong>CodeMateAI Foundation</strong>
    </footer>

    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js"
      integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y"
      crossorigin="anonymous"
    ></script>
    <script>
      // Ensure DOM is loaded before running JS
      document.addEventListener("DOMContentLoaded", function () {
        // Profile info
        const profile = JSON.parse(localStorage.getItem("userProfile") || "{}");
        const username = profile.name || "User";
        const email = profile.email || "user@email.com";
        if (document.getElementById("nav-username")) {
          document.getElementById("nav-username").textContent = username;
        }
        if (document.getElementById("dropdown-username")) {
          document.getElementById("dropdown-username").textContent = username;
        }
        if (document.getElementById("dropdown-email")) {
          document.getElementById("dropdown-email").textContent = email;
        }
        if (document.getElementById("welcome-username")) {
          document.getElementById("welcome-username").textContent = username;
        }

        // AI Chat Dialog Logic (Frontend Only)
        const chatForm = document.getElementById("chat-form");
        const chatInput = document.getElementById("chat-input");
        const chatMessages = document.getElementById("chat-messages");
        const preferredCourses = document.getElementById("preferred-courses");
        // List of popular courses and keywords
        const courseMap = [
          {
            name: "Web Development Beginner",
            keywords: ["web development beginner", "html", "css"],
            link: "courses.html#web-beginner"
          },
          {
            name: "Web Development Intermediate",
            keywords: [
              "web development intermediate",
              "javascript",
              "react",
              "vue",
              "angular"
            ],
            link: "courses.html#web-intermediate"
          },
          {
            name: "Web Development Advanced",
            keywords: [
              "web development advanced",
              "devops",
              "ci/cd",
              "docker",
              "microservices"
            ],
            link: "courses.html#web-advanced"
          },
          {
            name: "Data Science Beginner",
            keywords: ["data science beginner", "python basics", "r basics"],
            link: "courses.html#ds-beginner"
          },
          {
            name: "Data Science Intermediate",
            keywords: [
              "data science intermediate",
              "pandas",
              "numpy",
              "matplotlib",
              "machine learning"
            ],
            link: "courses.html#ds-intermediate"
          },
          {
            name: "Data Science Advanced",
            keywords: [
              "data science advanced",
              "deep learning",
              "nlp",
              "kaggle"
            ],
            link: "courses.html#ds-advanced"
          },
          {
            name: "AI & ML Beginner",
            keywords: [
              "ai beginner",
              "ml beginner",
              "artificial intelligence beginner",
              "machine learning beginner"
            ],
            link: "courses.html#ai-beginner"
          },
          {
            name: "AI & ML Intermediate",
            keywords: [
              "ai intermediate",
              "ml intermediate",
              "machine learning intermediate",
              "tensorflow",
              "pytorch"
            ],
            link: "courses.html#ai-intermediate"
          },
          {
            name: "AI & ML Advanced",
            keywords: [
              "ai advanced",
              "ml advanced",
              "deep learning advanced",
              "nlp advanced",
              "reinforcement learning"
            ],
            link: "courses.html#ai-advanced"
          },
          {
            name: "Cybersecurity Beginner",
            keywords: [
              "cybersecurity beginner",
              "security basics",
              "firewalls",
              "antivirus"
            ],
            link: "courses.html#cyber-beginner"
          },
          {
            name: "Cybersecurity Intermediate",
            keywords: [
              "cybersecurity intermediate",
              "network security",
              "incident response"
            ],
            link: "courses.html#cyber-intermediate"
          },
          {
            name: "Cybersecurity Advanced",
            keywords: [
              "cybersecurity advanced",
              "penetration testing",
              "oscp",
              "cissp"
            ],
            link: "courses.html#cyber-advanced"
          }
        ];
        // Helper to check if input matches any course keyword
        function matchesAnyCourse(input) {
          return courseMap.some((course) =>
            course.keywords.some((kw) => input.toLowerCase().includes(kw))
          );
        }

        function getRecommendedCourses(userMsg) {
          const input = userMsg.toLowerCase();
          let recommended = [];
          for (const course of courseMap) {
            if (course.keywords.some((kw) => input.includes(kw))) {
              recommended.push(course);
            }
          }
          // If user is undecided or asks for a general course, show all levels for each course
          if (
            input.includes("i don't know what to learn") ||
            input.includes("dont know what to learn") ||
            input.includes("confused") ||
            input.includes("which programming language is best") ||
            input.includes("best programming language") ||
            input.includes("which course") ||
            input.includes("what should i learn") ||
            input.includes("web development") ||
            input.includes("data science") ||
            input.includes("ai") ||
            input.includes("cybersecurity")
          ) {
            recommended = courseMap;
          }
          return recommended;
        }

        if (chatForm) {
          chatForm.addEventListener("submit", function (e) {
            e.preventDefault();
            const userMsg = chatInput.value.trim();
            if (!userMsg) return;
            chatMessages.innerHTML += `<div style='text-align:right;'><span style='background:#1976d2;color:#fff;padding:6px 14px;border-radius:12px;display:inline-block;margin-bottom:4px;'>${userMsg}</span></div>`;
            chatInput.value = "";

            // Use external chat logic
            let aiResponse = "";
            if (typeof window.getAIResponse === "function") {
              aiResponse = window.getAIResponse(userMsg);
              // If no course matches, ask for clarification
              if (
                !matchesAnyCourse(userMsg) &&
                aiResponse ===
                  "I couldn't detect a specific interest or topic. Please enter any of your interests (like web development, data science, mobile apps, game development, cybersecurity, etc.) and I'll give you personalized advice!"
              ) {
                aiResponse =
                  "Please explain your interested domain, like web development, python development, data science, AI, cybersecurity, etc.";
              }
              chatMessages.innerHTML += `<div style='text-align:left;'><span style='background:#e3eafc;color:#1976d2;padding:6px 14px;border-radius:12px;display:inline-block;margin-bottom:4px;'><i class='fa fa-robot me-2'></i>${aiResponse.replace(
                /\n/g,
                "<br>"
              )}</span></div>`;
            } else {
              chatMessages.innerHTML += `<div style='text-align:left;'><span style='background:#ffdddd;color:#d32f2f;padding:6px 14px;border-radius:12px;display:inline-block;margin-bottom:4px;'>Error: AI chat logic not loaded. Please check that ai-chat-logic.js is present and loaded before this script.</span></div>`;
            }
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Show preferred courses
            const recommended = getRecommendedCourses(userMsg);
            if (recommended.length > 0) {
              preferredCourses.innerHTML = `<div class='mb-2 fw-bold' style='color:#1976d2;'>Preferred Courses for You:</div><div class='d-flex flex-wrap gap-3'>${recommended
                .map(
                  (course) =>
                    `<a href='${course.link}' class='btn btn-outline-primary' style='min-width:180px;font-weight:500;'>${course.name}</a>`
                )
                .join("")}</div>`;
            } else {
              preferredCourses.innerHTML = "";
            }
          });
        }
      });
    </script>
  </body>
</html>
